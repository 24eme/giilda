input {
	couchdb_changes {
		db => "giilda_ivso"
		initial_sequence => 0
	}

}
filter {
	if [@metadata][_id] !~ /^VRAC-.+$/ {
		drop { }
	}
	mutate {
		add_field => { "type" => "%{[@metadata][_id]}" }
	}
	mutate {
		gsub => [
			"type", "^([A-Z]+)-.+$", "\1"
		]
	}

}
output {
        if [@metadata][action] == 'delete' {
                http {
                        http_method => "delete"
                        url => "http://localhost:9200/giilda_ivso_vrac/%{[type]}/%{[@metadata][_id]}"
                }
        } else {
                elasticsearch {
                        index => "giilda_ivso"
                        document_id => "%{[@metadata][_id]}"
			flush_size => 10
			manage_template => false
                }
        }
}
